1:"$Sreact.fragment"
2:I[3704,["177","static/chunks/app/layout-fc61d8c659479b00.js"],""]
3:I[5244,[],""]
4:I[3866,[],""]
6:I[6213,[],"OutletBoundary"]
8:I[6213,[],"MetadataBoundary"]
a:I[6213,[],"ViewportBoundary"]
c:I[4835,[],""]
:HL["/_next/static/media/7b0b24f36b1a6d0b-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/14914623d32d605a.css","style"]
0:{"P":null,"b":"vIR5sWEpyy7FgVUFyZe3H","p":"","c":["","blog","insercao-de-dados-em-massa"],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","insercao-de-dados-em-massa","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/14914623d32d605a.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","$L2",null,{"src":"https://www.googletagmanager.com/gtag/js?id=G-QY2VMWMXL2","strategy":"beforeInteractive"}],["$","$L2",null,{"id":"google-analytics","strategy":"beforeInteractive","children":"\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'G-QY2VMWMXL2');\n          "}]]}],["$","body",null,{"className":"__className_ed3508","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","insercao-de-dados-em-massa","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",null,["$","$L6",null,{"children":"$L7"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","GDCDDsqZzaDcXFoGzQC0M",{"children":[["$","$L8",null,{"children":"$L9"}],["$","$La",null,{"children":"$Lb"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}]]}],false]],"m":"$undefined","G":["$c","$undefined"],"s":false,"S":true}
d:I[3818,["208","static/chunks/208-673db12e6e83b7c3.js","953","static/chunks/app/blog/%5Bslug%5D/page-8507fdcc32d83c40.js"],"default"]
e:I[7970,["208","static/chunks/208-673db12e6e83b7c3.js","953","static/chunks/app/blog/%5Bslug%5D/page-8507fdcc32d83c40.js"],"Image"]
5:["$","$Ld",null,{"post":{"meta":{"slug":"insercao-de-dados-em-massa","title":"Inserção de dados em massa em bancos relacionais","excerpt":"","date":"2023-05-05","imageUrl":"/images/blog/insercao.jpg","tags":["Ruby","Rails","Backend","Banco de dados"],"author":{"name":"Vinicius Lisboa","imageUrl":"/images/vinicius.jpeg"}},"content":[["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["$","em",null,{"className":"italic text-gray-700","children":"Texto originalmente publicado em meu antigo medium no dia 5 de Maio de 2023"}]}],"\n",["$","blockquote",null,{"className":"border-l-4 border-green-500 pl-4 italic text-gray-600 mb-6","children":["\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"“A eficiência é fazer melhor o que já está sendo feito.” — Peter Drucker"}],"\n"]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Existem alguns benefícios muito claros pra utilização de inserção de dados em massa, mas acredito que a principal razão pra alguém procurar esta funcionalidade é ",["$","strong",null,{"className":"font-semibold text-gray-900","children":"performance"}],"."]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Muitos cenários exigem uma grande quantidade de ",["$","em",null,{"className":"italic text-gray-700","children":"inserções"}]," de dados, o que nos leva a duas principais abordagens."]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Num primeiro caso poderíamos inserir um conjunto de dados em uma tabela realizando uma ",["$","em",null,{"className":"italic text-gray-700","children":"query"}]," para cada registro que desejamos adicionar."]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Quando temos um pequeno conjunto de dados essa abordagem pode funcionar bem. Por exemplo, em um banco temos as tabelas de Editoras, Livros e Reviews:"}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["$","div",null,{"className":"my-8 flex justify-center","children":["$","$Le",null,{"src":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d2m4scd74qi4h9fv6gbw.png","alt":"Image description","width":600,"height":300,"className":"rounded-lg shadow-lg max-w-2xl w-full h-auto","unoptimized":true}]}]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Se utilizarmos alguns laços de repetição, teríamos a seguinte quantidade de queries:"}],"\n",["$","ul",null,{"className":"list-disc pl-6 mb-6 space-y-2","children":["\n",["$","li",null,{"className":"text-gray-700","children":"1 query para editoras"}],"\n",["$","li",null,{"className":"text-gray-700","children":"10 queries para livros"}],"\n",["$","li",null,{"className":"text-gray-700","children":"10 query para review"}],"\n"]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"21 inserções no banco de dados podem ser executadas em um tempo quase que imperceptível e em um custo de processamento baixo."}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Os problemas começam a surgir quando essas ações escalam. Nesse mesmo exemplo se considerarmos os seguintes números:"}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["$","div",null,{"className":"my-8 flex justify-center","children":["$","$Le",null,{"src":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lusu8vscc9zkgw5wuq4f.png","alt":"Image description","width":600,"height":300,"className":"rounded-lg shadow-lg max-w-2xl w-full h-auto","unoptimized":true}]}]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Teremos o seguinte resultado em inserções:"}],"\n",["$","ul",null,{"className":"list-disc pl-6 mb-6 space-y-2","children":["\n",["$","li",null,{"className":"text-gray-700","children":"100 queries para editoras"}],"\n",["$","li",null,{"className":"text-gray-700","children":"1.000.000 (100*10.000) de queries para livros"}],"\n",["$","li",null,{"className":"text-gray-700","children":"3.000.000 (1.000.000*3) de queries para reviews"}],"\n"]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Totalizando 4.000.100 queries. Aqui o tempo de execução já é ",["$","strong",null,{"className":"font-semibold text-gray-900","children":"muito maior"}]," e o custo de processamento também."]}],"\n",["$","h2",null,{"className":"text-3xl font-bold text-gray-900 mb-6 mt-10","children":"INSERT INTO"}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Para essas situações os bancos de dados relacionais nos oferecem uma solução muito inteligente. Temos a possibilidade de utilizar uma declaração SQL que consegue inserir ",["$","em",null,{"className":"italic text-gray-700","children":"múltiplos"}]," ",["$","em",null,{"className":"italic text-gray-700","children":"registros"}]," em uma tabela com uma única ",["$","em",null,{"className":"italic text-gray-700","children":"query “atômica”"}],"."]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["No caso anterior, se tratando das três tabelas que totalizavam por volta de 4 milhões de queries, conseguimos, com INSERT INTO, realizar a mesma ação com apenas três ",["$","em",null,{"className":"italic text-gray-700","children":"queries."}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Esse é um exemplo genérico da utilização dessa declaração:"}],"\n",["$","div",null,{"className":"relative mb-6","children":[false,["$","pre",null,{"className":"language-text bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8","children":["$","code",null,{"className":"language-text","children":"INSERT INTO table_name (column_name1, column_name2, column_name3, column_name4)   \nVALUES   \n(value1, value2, value3, value4),   \n(value1, value2, value3, value4);\n"}]}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Alguns meses atrás utilizei a inserção em massa na refatoração de uma funcionalidade importante, pra isso fizemos alguns estudos e levantamentos de informações, o que acabou se tornando uma magia (capacitação) e agora esse texto."}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Nessa sintaxe, após o “INSERT INTO”, informamos o nome da tabela, seguido pelas colunas que vão ser preenchidas. Na seção dos VALUES informamos os valores correspondentes as colunas para cada registros que queremos adicionar."}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"As queries para nosso exemplo seriam as seguintes:"}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Editoras:"}],"\n",["$","div",null,{"className":"relative mb-6","children":[false,["$","pre",null,{"className":"language-text bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8","children":["$","code",null,{"className":"language-text","children":"INSERT INTO Editoras (id, nome, dono, email)   \nVALUES   \n(1, Sétimo Selo, Pessoa1, email@email.com),   \n(2, Companhia das Letras, Pessoa2, email@email.com),  \n…  \nX100\n"}]}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Livros:"}],"\n",["$","div",null,{"className":"relative mb-6","children":[false,["$","pre",null,{"className":"language-text bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8","children":["$","code",null,{"className":"language-text","children":"INSERT INTO Livros (id, autor, id_editora)   \nVALUES   \n(1, Livro1, Pessoa1, 1),   \n(2, Livro2, Pessoa2, 2),  \n…  \nX1.000.000\n"}]}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Reviews:"}],"\n",["$","div",null,{"className":"relative mb-6","children":[false,["$","pre",null,{"className":"language-text bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8","children":["$","code",null,{"className":"language-text","children":"INSERT INTO Review (id, id_usuário, id_livro, comentário)   \nVALUES   \n(1, 1, Pessoa1, 1, “muito bom!”),   \n(2, 2, Pessoa2, 2, “excelente livro!”),  \n…  \nX3.000.000\n"}]}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Reduzir a quantidade de ",["$","em",null,{"className":"italic text-gray-700","children":"queries"}]," pode permitir que o banco de dados otimize a operação. Além disso, quando inserimos múltiplos registros em uma única transação, o banco de dados pode melhorar a integridade dos dados e reduzir a possibilidade de erros de transação, como falhas de conexão ou interrupções."]}],"\n",["$","h2",null,{"className":"text-3xl font-bold text-gray-900 mb-6 mt-10","children":["$","strong",null,{"className":"font-semibold text-gray-900","children":"ActiveRecord-Import"}]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Se trouxermos esse conceito para o desenvolvimento web (mais especificamente com Ruby on Rails), a partir do ",["$","em",null,{"className":"italic text-gray-700","children":"Rails 6"}]," já é possível utilizar SQL ",["$","em",null,{"className":"italic text-gray-700","children":"inserts"}]," com métodos nativos do framework, o ",["$","a",null,{"className":"text-green-600 hover:text-green-700 hover:underline transition-colors","href":"https://apidock.com/rails/v6.0.0/ActiveRecord/Persistence/ClassMethods/insert","children":"insert"}]," e mais apropriado ao nosso caso o ",["$","a",null,{"className":"text-green-600 hover:text-green-700 hover:underline transition-colors","href":"https://apidock.com/rails/v6.0.0/ActiveRecord/Persistence/ClassMethods/insert_all","children":"insert_all"}],". Ótima solução!"]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Ainda não testei esse método (ainda!), por isso vou usar como exemplo pra contextos web a gem ",["$","a",null,{"className":"text-green-600 hover:text-green-700 hover:underline transition-colors","href":"https://github.com/zdennis/activerecord-import","children":"Activerecord-Import"}]," que funcionou muito bem com ",["$","em",null,{"className":"italic text-gray-700","children":"Rails 5."}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Continuando com nosso exemplo, ao inserirmos 10 livros com um laço de repetição e uma ",["$","em",null,{"className":"italic text-gray-700","children":"query"}]," para cada registro, teremos um código parecido com este:"]}],"\n",["$","div",null,{"className":"relative mb-6","children":[false,["$","pre",null,{"className":"language-text bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8","children":["$","code",null,{"className":"language-text","children":"10.times do |i|  \n  Book.create! name: \"book #{i}\"  \nend\n"}]}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["A gem adiciona para cada Model da nossa aplicação um método chamado ",["$","em",null,{"className":"italic text-gray-700","children":"import"}],", é por ele que vamos realizar as operações, teríamos algo assim:"]}],"\n",["$","div",null,{"className":"relative mb-6","children":[false,["$","pre",null,{"className":"language-text bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8","children":["$","code",null,{"className":"language-text","children":"books = []  \n10.times do |i|  \n  books << Book.new(name: \"book #{i}\")  \nend \n"}]}]]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Book.import books"}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["Declaramos um array vazio e preenchemos com os registros criados (ainda não salvos no banco); após isso podemos passar o array como parâmetro do método ",["$","em",null,{"className":"italic text-gray-700","children":"import"}]," que nossa operação será realizada com INSERT INTO."]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["A ",["$","a",null,{"className":"text-green-600 hover:text-green-700 hover:underline transition-colors","href":"https://github.com/zdennis/activerecord-import","children":"gem"}]," adiciona outras funcionalidades muito interessantes, como parametrização das validações do model, tratativas para registros com chaves duplicas etc."]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["É importante dizer também que o ganho em ",["$","strong",null,{"className":"font-semibold text-gray-900","children":"performance"}]," e outros benefícios podem não se aplicar a todos os casos. Dependendo da quantidade de registros a ser adicionados e da capacidade do banco em lidar com os registros em poucas inserções. Por isso, uma análise deve ser construída considerando cada caso particular. Sempre vale a pena fazer um Benchmark!"]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":["$","em",null,{"className":"italic text-gray-700","children":"Alguns meses atrás utilizamos a inserção em massa na refatoração de uma funcionalidade importante, pra isso fizemos alguns estudos e levantamentos de informações, o que acabou se tornando uma magia (capacitação) e agora esse texto."}]}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"Se você chegou até aqui, obrigado!"}],"\n",["$","p",null,{"className":"text-gray-700 leading-relaxed mb-4","children":"E se isso foi de alguma forma instrutivo e te ajudou, ficarei muito feliz em saber."}]]}}]
b:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
9:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Inserção de dados em massa em bancos relacionais | Blog de Vinicius Lisboa"}],["$","link","2",{"rel":"manifest","href":"/manifest.webmanifest","crossOrigin":"$undefined"}],["$","meta","3",{"name":"robots","content":"index, follow"}],["$","meta","4",{"property":"og:title","content":"Inserção de dados em massa em bancos relacionais"}],["$","meta","5",{"property":"og:url","content":"https://viniciuslisboa07.github.io/blog/insercao-de-dados-em-massa"}],["$","meta","6",{"property":"og:site_name","content":"Blog de Vinicius Lisboa"}],["$","meta","7",{"property":"og:image","content":"http://localhost:3000/images/blog/insercao.jpg"}],["$","meta","8",{"property":"og:image:width","content":"1200"}],["$","meta","9",{"property":"og:image:height","content":"630"}],["$","meta","10",{"property":"og:image:alt","content":"Inserção de dados em massa em bancos relacionais"}],["$","meta","11",{"property":"og:type","content":"article"}],["$","meta","12",{"property":"article:published_time","content":"2023-05-05"}],["$","meta","13",{"property":"article:author","content":"Vinicius Lisboa"}],["$","meta","14",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","15",{"name":"twitter:title","content":"Inserção de dados em massa em bancos relacionais"}],["$","meta","16",{"name":"twitter:image","content":"http://localhost:3000/images/blog/insercao.jpg"}],["$","link","17",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","link","18",{"rel":"icon","href":"/icon?eacec83176f30837","alt":"$undefined","type":"image/png","sizes":"32x32"}]]
7:null
