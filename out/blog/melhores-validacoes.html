<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/7b0b24f36b1a6d0b-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/14914623d32d605a.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-c9b793a5deeb135f.js"/><script src="/_next/static/chunks/4bd1b696-aaf09b882924c802.js" async=""></script><script src="/_next/static/chunks/517-1aa39bab3933c6e2.js" async=""></script><script src="/_next/static/chunks/main-app-eb4ba1fd5bb32f2e.js" async=""></script><script src="/_next/static/chunks/app/layout-fc61d8c659479b00.js" async=""></script><script src="/_next/static/chunks/208-673db12e6e83b7c3.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-8507fdcc32d83c40.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-QY2VMWMXL2" as="script"/><meta name="next-size-adjust" content=""/><title>Melhores Validações | Blog de Vinicius Lisboa</title><meta name="description" content="Validando on rails"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="robots" content="index, follow"/><meta property="og:title" content="Melhores Validações"/><meta property="og:description" content="Validando on rails"/><meta property="og:url" content="https://viniciuslisboa07.github.io/blog/melhores-validacoes"/><meta property="og:site_name" content="Blog de Vinicius Lisboa"/><meta property="og:image" content="http://localhost:3000/images/blog/validacao.png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="Melhores Validações"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-12-27"/><meta property="article:author" content="Vinicius Lisboa"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Melhores Validações"/><meta name="twitter:description" content="Validando on rails"/><meta name="twitter:image" content="http://localhost:3000/images/blog/validacao.png"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><link rel="icon" href="/icon?eacec83176f30837" type="image/png" sizes="32x32"/><script>(self.__next_s=self.__next_s||[]).push(["https://www.googletagmanager.com/gtag/js?id=G-QY2VMWMXL2",{}])</script><script>(self.__next_s=self.__next_s||[]).push([0,{"children":"\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'G-QY2VMWMXL2');\n          ","id":"google-analytics"}])</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_ed3508"><section class="py-20 pt-32 bg-white text-black"><div class="container mx-auto px-8"><a class="flex items-center text-green-600 mb-8 font-medium" href="/blog"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path></svg>back_to_blog</a><div style="opacity:0;transform:translateY(20px)"><h1 class="text-4xl md:text-5xl font-black mb-6">Melhores Validações</h1><div class="flex items-center mb-8"><div class="flex items-center mr-6"><div class="w-10 h-10 rounded-full bg-gray-200 mr-3 relative"><img alt="Vinicius Lisboa" loading="lazy" decoding="async" data-nimg="fill" class="rounded-full" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:cover;color:transparent" src="/images/vinicius.jpeg"/></div><span class="font-medium">Vinicius Lisboa</span></div><div class="text-gray-500">26/12/2025</div></div><div class="aspect-video bg-gray-200 rounded-xl mb-8 overflow-hidden relative"><img alt="Melhores Validações" loading="lazy" decoding="async" data-nimg="fill" class="object-cover" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="/images/blog/validacao.png"/></div><div class="flex gap-2 mb-8"><span class="px-3 py-1 bg-gray-100 text-sm rounded-full text-gray-600">Rails</span></div><article class="prose prose-lg mx-auto max-w-4xl"><p class="text-gray-700 leading-relaxed mb-4">Uma distinção muito simples e interessante trazida pelo livro <em class="italic text-gray-700">Layerd Design for Ruby on Rails Applications</em> é a de validações de Transação e validações de Consistência. A primeira trata de validações que definem quando e como um estado pode ser alterado e a segunda trata de validações que restringem o que deve ou não ser alterado. No exemplo do livro:</p>
<ul class="list-disc pl-6 mb-6 space-y-2">
<li class="text-gray-700">Uma publicação (de um blog, por exemplo) não pode ser alterada de <em class="italic text-gray-700">rascunho</em> depois de já ter sido alterada para <em class="italic text-gray-700">publicada</em> em algum momento.<!-- -->
<ul class="list-disc pl-6 mb-6 space-y-2">
<li class="text-gray-700">Essa <em class="italic text-gray-700">regra</em> deve ser entendida como uma regra de transação</li>
</ul>
</li>
<li class="text-gray-700">Uma publicação não deve ser criada sem um título<!-- -->
<ul class="list-disc pl-6 mb-6 space-y-2">
<li class="text-gray-700">Essa <em class="italic text-gray-700">regra</em> deve ser entendida como uma regra de consistência</li>
</ul>
</li>
</ul>
<p class="text-gray-700 leading-relaxed mb-4">O que está por trás dessa distinção é a noção <em class="italic text-gray-700">tempo</em>. Uma regra de consistência precisa ser valida em qualquer dado momento do ciclo de vida da nossa aplicação. Por sua vez, uma validação de transação só faz sentido num fluxo dinâmico de alterações.</p>
<p class="text-gray-700 leading-relaxed mb-4">Ambas validações podem ser feitas dentro de um model Rails (ActiveModel) comum através da reserved keyword <em class="italic text-gray-700">validate(s)</em>.</p>
<div class="relative mb-6"><div class="absolute top-0 right-0 bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-bl-lg rounded-tr-lg">ruby</div><pre class="language-ruby bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8"><code class="language-ruby">class Post &lt; ApplicationRecord
	  validate :prevent_drafting_published,
	    if: -&gt; { published? &amp;&amp; will_save_change_to_draft? }
	    
	  validates :title, presence: true
	  
	  def prevent_drafting_published
	    errors.add(:base, &quot;Switching back to draft is not
	      allowed for published posts&quot;)
	  end
end
</code></pre></div>
<p class="text-gray-700 leading-relaxed mb-4">Note como a validação de transação só pode existir apartir de uma <em class="italic text-gray-700">condição</em>, o que denota sua caracterisca dinâmica. Enquanto a validação de consistência não precisa de condição nenhuma para que seja uma regra necessária.</p>
<p class="text-gray-700 leading-relaxed mb-4">Esse primeiro tipo de validação, que exige uma condição, normalmente contribui para um problema de quebra de responsabilidade. <strong class="font-semibold text-gray-900">Um model deve declarar suas validações mas não deve implementa-las</strong>. Se nos atermos a essa regra vamos perceber que o proprio rails já a segue. Quando usamos o <em class="italic text-gray-700">validates presence: true</em>, estamos declarando a validação em nosso model e usando uma implementação externa a ele, no caso a classe <strong class="font-semibold text-gray-900"><a class="text-green-600 hover:text-green-700 hover:underline transition-colors" href="https://www.rubydoc.info/docs/rails/ActiveModel/Validations/PresenceValidator">PresenceValidator</a></strong> implementa as regras de presença de atributos.</p>
<p class="text-gray-700 leading-relaxed mb-4">Desta mesma forma, o livro nos mostra que podemos implementar nossos proprios métodos de validações, externos aos models e que extendem da mesma classe da qual extendem os metódos de validação padrão do rails.</p>
<div class="relative mb-6"><div class="absolute top-0 right-0 bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-bl-lg rounded-tr-lg">ruby</div><pre class="language-ruby bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8"><code class="language-ruby">class Post::DraftValidator &lt; ActiveModel::Validator
  def validate(post)
	    return unless post.published?
	    return unless post.will_save_change_to_draft
	    
	    post.errors.add(:base, &quot;Switching back to draft is not
	      allowed for published posts&quot;)
	  end
end

class Post &lt; ApplicationRecord
	  validates_with DraftValidator
end
</code></pre></div>
<p class="text-gray-700 leading-relaxed mb-4">Essa refatoração nos permite extrair a implementação das regras de validação para classes separadas em seus proprios contextos enquanto nosso model ainda mantem o mesmo comportamento.</p>
<p class="text-gray-700 leading-relaxed mb-4">Além dessa refatoração, outra consideração importante apontada é a relacionada aos contextos de validações. Quando diretamente no model as validações são <em class="italic text-gray-700">context-free</em> ou seja, executam sempre que houve um <em class="italic text-gray-700">commit</em> (seja um save ou update), independente de qualquer contexto envolto na ação, o que pode tornar muitas validações redundantes. Para isso o ActiveRecord nos fornece a opção <em class="italic text-gray-700">on</em>, que normalmente é usada para restringir callbacks e validações a criação ou atualização (on: :create ou on: :update), porém também podemos criar nossos próprios contextos em um model. Em nosso exemplo:</p>
<div class="relative mb-6"><div class="absolute top-0 right-0 bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-bl-lg rounded-tr-lg">ruby</div><pre class="language-ruby bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8"><code class="language-ruby">class Post &lt; ApplicationRecord
	  validates_with DraftValidator, on: :draft
	  
	  def draft
		  self.status = :draft
		  save!(context: :draft)
	  end
end
</code></pre></div>
<p class="text-gray-700 leading-relaxed mb-4">Esse contexto permite remover a linha &quot;return unless post.published?&quot; do validator e torna ele menos dependente do model.</p>
<p class="text-gray-700 leading-relaxed mb-4">Com essas refatorações nossas validações continuam proximas ao Rails Way e também distantes dos problemas comuns aos adicionarmos validações diretamente nos models.</p>
<p class="text-gray-700 leading-relaxed mb-4">--</p>
<p class="text-gray-700 leading-relaxed mb-4">A referência pra essa postagem:</p>
<p class="text-gray-700 leading-relaxed mb-4"><div class="my-8 flex justify-center"><img alt="Image description" loading="lazy" width="600" height="300" decoding="async" data-nimg="1" class="rounded-lg shadow-lg max-w-2xl w-full h-auto" style="color:transparent" src="/images/blog/layerdDesign.png"/></div></p></article><div class="border-t border-gray-200 mt-12 pt-8"><h3 class="text-2xl font-bold mb-6">share_post</h3><div class="flex gap-4"><button class="p-3 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></button><button class="p-3 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd"></path></svg></button><button class="p-3 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"></path></svg></button><button class="p-3 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></button></div></div></div></div></section><script src="/_next/static/chunks/webpack-c9b793a5deeb135f.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[3704,[\"177\",\"static/chunks/app/layout-fc61d8c659479b00.js\"],\"\"]\n3:I[5244,[],\"\"]\n4:I[3866,[],\"\"]\n6:I[6213,[],\"OutletBoundary\"]\n8:I[6213,[],\"MetadataBoundary\"]\na:I[6213,[],\"ViewportBoundary\"]\nc:I[4835,[],\"\"]\n:HL[\"/_next/static/media/7b0b24f36b1a6d0b-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/14914623d32d605a.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"vIR5sWEpyy7FgVUFyZe3H\",\"p\":\"\",\"c\":[\"\",\"blog\",\"melhores-validacoes\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"melhores-validacoes\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/14914623d32d605a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"$L2\",null,{\"src\":\"https://www.googletagmanager.com/gtag/js?id=G-QY2VMWMXL2\",\"strategy\":\"beforeInteractive\"}],[\"$\",\"$L2\",null,{\"id\":\"google-analytics\",\"strategy\":\"beforeInteractive\",\"children\":\"\\n            window.dataLayer = window.dataLayer || [];\\n            function gtag(){dataLayer.push(arguments);}\\n            gtag('js', new Date());\\n            gtag('config', 'G-QY2VMWMXL2');\\n          \"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_ed3508\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"melhores-validacoes\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":\"$L7\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"cwASfFEbyURb4_nNaqap6\",{\"children\":[[\"$\",\"$L8\",null,{\"children\":\"$L9\"}],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$c\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:I[3818,[\"208\",\"static/chunks/208-673db12e6e83b7c3.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-8507fdcc32d83c40.js\"],\"default\"]\ne:I[7970,[\"208\",\"static/chunks/208-673db12e6e83b7c3.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-8507fdcc32d83c40.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$Ld\",null,{\"post\":{\"meta\":{\"slug\":\"melhores-validacoes\",\"title\":\"Melhores Validações\",\"excerpt\":\"Validando on rails\",\"date\":\"2025-12-27\",\"imageUrl\":\"/images/blog/validacao.png\",\"tags\":[\"Rails\"],\"author\":{\"name\":\"Vinicius Lisboa\",\"imageUrl\":\"/images/vinicius.jpeg\"}},\"content\":[[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":[\"Uma distinção muito simples e interessante trazida pelo livro \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"Layerd Design for Ruby on Rails Applications\"}],\" é a de validações de Transação e validações de Consistência. A primeira trata de validações que definem quando e como um estado pode ser alterado e a segunda trata de validações que restringem o que deve ou não ser alterado. No exemplo do livro:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"list-disc pl-6 mb-6 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"text-gray-700\",\"children\":[\"Uma publicação (de um blog, por exemplo) não pode ser alterada de \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"rascunho\"}],\" depois de já ter sido alterada para \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"publicada\"}],\" em algum momento.\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"list-disc pl-6 mb-6 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"text-gray-700\",\"children\":[\"Essa \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"regra\"}],\" deve ser entendida como uma regra de transação\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"text-gray-700\",\"children\":[\"Uma publicação não deve ser criada sem um título\",\"\\n\",[\"$\",\"ul\",null,{\"className\":\"list-disc pl-6 mb-6 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"text-gray-700\",\"children\":[\"Essa \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"regra\"}],\" deve ser entendida como uma regra de consistência\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":[\"O que está por trás dessa distinção é a noção \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"tempo\"}],\". Uma regra de consistência precisa ser valida em qualquer dado momento do ciclo de vida da nossa aplicação. Por sua vez, uma validação de transação só faz sentido num fluxo dinâmico de alterações.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":[\"Ambas validações podem ser feitas dentro de um model Rails (ActiveModel) comum através da reserved keyword \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"validate(s)\"}],\".\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"relative mb-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-0 right-0 bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-bl-lg rounded-tr-lg\",\"children\":\"ruby\"}],[\"$\",\"pre\",null,{\"className\":\"language-ruby bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-ruby\",\"children\":\"class Post \u003c ApplicationRecord\\n\\t  validate :prevent_drafting_published,\\n\\t    if: -\u003e { published? \u0026\u0026 will_save_change_to_draft? }\\n\\t    \\n\\t  validates :title, presence: true\\n\\t  \\n\\t  def prevent_drafting_published\\n\\t    errors.add(:base, \\\"Switching back to draft is not\\n\\t      allowed for published posts\\\")\\n\\t  end\\nend\\n\"}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":[\"Note como a validação de transação só pode existir apartir de uma \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"condição\"}],\", o que denota sua caracterisca dinâmica. Enquanto a validação de consistência não precisa de condição nenhuma para que seja uma regra necessária.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":[\"Esse primeiro tipo de validação, que exige uma condição, normalmente contribui para um problema de quebra de responsabilidade. \",[\"$\",\"strong\",null,{\"className\":\"font-semibold text-gray-900\",\"children\":\"Um model deve declarar suas validações mas não deve implementa-las\"}],\". Se nos atermos a essa regra vamos perceber que o proprio rails já a segue. Quando usamos o \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"validates presence: true\"}],\", estamos declarando a validação em nosso model e usando uma implementação externa a ele, no caso a classe \",[\"$\",\"strong\",null,{\"className\":\"font-semibold text-gray-900\",\"children\":[\"$\",\"a\",null,{\"className\":\"text-green-600 hover:text-green-700 hover:underline transition-colors\",\"href\":\"https://www.rubydoc.info/docs/rails/ActiveModel/Validations/PresenceValidator\",\"children\":\"PresenceValidator\"}]}],\" implementa as regras de presença de atributos.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":\"Desta mesma forma, o livro nos mostra que podemos implementar nossos proprios métodos de validações, externos aos models e que extendem da mesma classe da qual extendem os metódos de validação padrão do rails.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"relative mb-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-0 right-0 bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-bl-lg rounded-tr-lg\",\"children\":\"ruby\"}],[\"$\",\"pre\",null,{\"className\":\"language-ruby bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-ruby\",\"children\":\"class Post::DraftValidator \u003c ActiveModel::Validator\\n  def validate(post)\\n\\t    return unless post.published?\\n\\t    return unless post.will_save_change_to_draft\\n\\t    \\n\\t    post.errors.add(:base, \\\"Switching back to draft is not\\n\\t      allowed for published posts\\\")\\n\\t  end\\nend\\n\\nclass Post \u003c ApplicationRecord\\n\\t  validates_with DraftValidator\\nend\\n\"}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":\"Essa refatoração nos permite extrair a implementação das regras de validação para classes separadas em seus proprios contextos enquanto nosso model ainda mantem o mesmo comportamento.\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":[\"Além dessa refatoração, outra consideração importante apontada é a relacionada aos contextos de validações. Quando diretamente no model as validações são \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"context-free\"}],\" ou seja, executam sempre que houve um \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"commit\"}],\" (seja um save ou update), independente de qualquer contexto envolto na ação, o que pode tornar muitas validações redundantes. Para isso o ActiveRecord nos fornece a opção \",[\"$\",\"em\",null,{\"className\":\"italic text-gray-700\",\"children\":\"on\"}],\", que normalmente é usada para restringir callbacks e validações a criação ou atualização (on: :create ou on: :update), porém também podemos criar nossos próprios contextos em um model. Em nosso exemplo:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"relative mb-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-0 right-0 bg-gray-700 text-gray-300 text-xs px-2 py-1 rounded-bl-lg rounded-tr-lg\",\"children\":\"ruby\"}],[\"$\",\"pre\",null,{\"className\":\"language-ruby bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto pt-8\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-ruby\",\"children\":\"class Post \u003c ApplicationRecord\\n\\t  validates_with DraftValidator, on: :draft\\n\\t  \\n\\t  def draft\\n\\t\\t  self.status = :draft\\n\\t\\t  save!(context: :draft)\\n\\t  end\\nend\\n\"}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":\"Esse contexto permite remover a linha \\\"return unless post.published?\\\" do validator e torna ele menos dependente do model.\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":\"Com essas refatorações nossas validações continuam proximas ao Rails Way e também distantes dos problemas comuns aos adicionarmos validações diretamente nos models.\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":\"--\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":\"A referência pra essa postagem:\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"text-gray-700 leading-relaxed mb-4\",\"children\":[\"$\",\"div\",null,{\"className\":\"my-8 flex justify-center\",\"children\":[\"$\",\"$Le\",null,{\"src\":\"/images/blog/layerdDesign.png\",\"alt\":\"Image description\",\"width\":600,\"height\":300,\"className\":\"rounded-lg shadow-lg max-w-2xl w-full h-auto\"}]}]}]]}}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"9:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Melhores Validações | Blog de Vinicius Lisboa\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Validando on rails\"}],[\"$\",\"link\",\"3\",{\"rel\":\"manifest\",\"href\":\"/manifest.webmanifest\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Melhores Validações\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Validando on rails\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"https://viniciuslisboa07.github.io/blog/melhores-validacoes\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:site_name\",\"content\":\"Blog de Vinicius Lisboa\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/images/blog/validacao.png\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:image:alt\",\"content\":\"Melhores Validações\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"property\":\"article:published_time\",\"content\":\"2025-12-27\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:author\",\"content\":\"Vinicius Lisboa\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:title\",\"content\":\"Melhores Validações\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:description\",\"content\":\"Validando on rails\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/images/blog/validacao.png\"}],[\"$\",\"link\",\"20\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"21\",{\"rel\":\"icon\",\"href\":\"/icon?eacec83176f30837\",\"alt\":\"$undefined\",\"type\":\"image/png\",\"sizes\":\"32x32\"}]]\n"])</script><script>self.__next_f.push([1,"7:null\n"])</script></body></html>