1:"$Sreact.fragment"
2:I[5244,[],""]
3:I[3866,[],""]
5:I[6213,[],"OutletBoundary"]
7:I[6213,[],"MetadataBoundary"]
9:I[6213,[],"ViewportBoundary"]
b:I[4835,[],""]
:HL["/_next/static/media/c7f848bed9dd25a3-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/e1027ea939f04857.css","style"]
0:{"P":null,"b":"3juqDD9ypWDUdfLWrhN3Z","p":"","c":["","blog","insercao-de-dados-em-massa"],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","insercao-de-dados-em-massa","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e1027ea939f04857.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__className_d28b19","children":["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","insercao-de-dados-em-massa","d"],["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L4",null,["$","$L5",null,{"children":"$L6"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","-jT66oWG9Yk7b2NRgDrrD",{"children":[["$","$L7",null,{"children":"$L8"}],["$","$L9",null,{"children":"$La"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}]]}],false]],"m":"$undefined","G":["$b","$undefined"],"s":false,"S":true}
c:I[3818,["208","static/chunks/208-673db12e6e83b7c3.js","953","static/chunks/app/blog/%5Bslug%5D/page-54c2ee0137c811da.js"],"default"]
4:["$","$Lc",null,{"post":{"meta":{"slug":"insercao-de-dados-em-massa","title":"Inserção de dados em massa em bancos relacionais","excerpt":"","date":"2023-05-05","imageUrl":"/images/blog/insercao.jpg","tags":["Ruby","Rails","Backend","Banco de dados"],"author":{"name":"Vinicius Lisboa","imageUrl":"/images/vinicius.jpeg"}},"content":[["$","p",null,{"children":["$","em",null,{"children":"Texto originalmente publicado em meu antigo medium no dia 5 de Maio de 2023"}]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":"“A eficiência é fazer melhor o que já está sendo feito.” — Peter Drucker"}],"\n"]}],"\n",["$","p",null,{"children":["Existem alguns benefícios muito claros pra utilização de inserção de dados em massa, mas acredito que a principal razão pra alguém procurar esta funcionalidade é ",["$","strong",null,{"children":"performance"}],"."]}],"\n",["$","p",null,{"children":["Muitos cenários exigem uma grande quantidade de ",["$","em",null,{"children":"inserções"}]," de dados, o que nos leva a duas principais abordagens."]}],"\n",["$","p",null,{"children":["Num primeiro caso poderíamos inserir um conjunto de dados em uma tabela realizando uma ",["$","em",null,{"children":"query"}]," para cada registro que desejamos adicionar."]}],"\n",["$","p",null,{"children":"Quando temos um pequeno conjunto de dados essa abordagem pode funcionar bem. Por exemplo, em um banco temos as tabelas de Editoras, Livros e Reviews:"}],"\n",["$","p",null,{"children":["$","img",null,{"src":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/d2m4scd74qi4h9fv6gbw.png","alt":"Image description"}]}],"\n",["$","p",null,{"children":"Se utilizarmos alguns laços de repetição, teríamos a seguinte quantidade de queries:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"1 query para editoras"}],"\n",["$","li",null,{"children":"10 queries para livros"}],"\n",["$","li",null,{"children":"10 query para review"}],"\n"]}],"\n",["$","p",null,{"children":"21 inserções no banco de dados podem ser executadas em um tempo quase que imperceptível e em um custo de processamento baixo."}],"\n",["$","p",null,{"children":"Os problemas começam a surgir quando essas ações escalam. Nesse mesmo exemplo se considerarmos os seguintes números:"}],"\n",["$","p",null,{"children":["$","img",null,{"src":"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/lusu8vscc9zkgw5wuq4f.png","alt":"Image description"}]}],"\n",["$","p",null,{"children":"Teremos o seguinte resultado em inserções:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"100 queries para editoras"}],"\n",["$","li",null,{"children":"1.000.000 (100*10.000) de queries para livros"}],"\n",["$","li",null,{"children":"3.000.000 (1.000.000*3) de queries para reviews"}],"\n"]}],"\n",["$","p",null,{"children":["Totalizando 4.000.100 queries. Aqui o tempo de execução já é ",["$","strong",null,{"children":"muito maior"}]," e o custo de processamento também."]}],"\n",["$","h2",null,{"children":"INSERT INTO"}],"\n",["$","p",null,{"children":["Para essas situações os bancos de dados relacionais nos oferecem uma solução muito inteligente. Temos a possibilidade de utilizar uma declaração SQL que consegue inserir ",["$","em",null,{"children":"múltiplos"}]," ",["$","em",null,{"children":"registros"}]," em uma tabela com uma única ",["$","em",null,{"children":"query “atômica”"}],"."]}],"\n",["$","p",null,{"children":["No caso anterior, se tratando das três tabelas que totalizavam por volta de 4 milhões de queries, conseguimos, com INSERT INTO, realizar a mesma ação com apenas três ",["$","em",null,{"children":"queries."}]]}],"\n",["$","p",null,{"children":"Esse é um exemplo genérico da utilização dessa declaração:"}],"\n",["$","pre",null,{"children":["$","code",null,{"children":"INSERT INTO table_name (column_name1, column_name2, column_name3, column_name4)   \nVALUES   \n(value1, value2, value3, value4),   \n(value1, value2, value3, value4);\n"}]}],"\n",["$","p",null,{"children":"Alguns meses atrás utilizei a inserção em massa na refatoração de uma funcionalidade importante, pra isso fizemos alguns estudos e levantamentos de informações, o que acabou se tornando uma magia (capacitação) e agora esse texto."}],"\n",["$","p",null,{"children":"Nessa sintaxe, após o “INSERT INTO”, informamos o nome da tabela, seguido pelas colunas que vão ser preenchidas. Na seção dos VALUES informamos os valores correspondentes as colunas para cada registros que queremos adicionar."}],"\n",["$","p",null,{"children":"As queries para nosso exemplo seriam as seguintes:"}],"\n",["$","p",null,{"children":"Editoras:"}],"\n",["$","pre",null,{"children":["$","code",null,{"children":"INSERT INTO Editoras (id, nome, dono, email)   \nVALUES   \n(1, Sétimo Selo, Pessoa1, email@email.com),   \n(2, Companhia das Letras, Pessoa2, email@email.com),  \n…  \nX100\n"}]}],"\n",["$","p",null,{"children":"Livros:"}],"\n",["$","pre",null,{"children":["$","code",null,{"children":"INSERT INTO Livros (id, autor, id_editora)   \nVALUES   \n(1, Livro1, Pessoa1, 1),   \n(2, Livro2, Pessoa2, 2),  \n…  \nX1.000.000\n"}]}],"\n",["$","p",null,{"children":"Reviews:"}],"\n",["$","pre",null,{"children":["$","code",null,{"children":"INSERT INTO Review (id, id_usuário, id_livro, comentário)   \nVALUES   \n(1, 1, Pessoa1, 1, “muito bom!”),   \n(2, 2, Pessoa2, 2, “excelente livro!”),  \n…  \nX3.000.000\n"}]}],"\n",["$","p",null,{"children":["Reduzir a quantidade de ",["$","em",null,{"children":"queries"}]," pode permitir que o banco de dados otimize a operação. Além disso, quando inserimos múltiplos registros em uma única transação, o banco de dados pode melhorar a integridade dos dados e reduzir a possibilidade de erros de transação, como falhas de conexão ou interrupções."]}],"\n",["$","h2",null,{"children":["$","strong",null,{"children":"ActiveRecord-Import"}]}],"\n",["$","p",null,{"children":["Se trouxermos esse conceito para o desenvolvimento web (mais especificamente com Ruby on Rails), a partir do ",["$","em",null,{"children":"Rails 6"}]," já é possível utilizar SQL ",["$","em",null,{"children":"inserts"}]," com métodos nativos do framework, o ",["$","a",null,{"href":"https://apidock.com/rails/v6.0.0/ActiveRecord/Persistence/ClassMethods/insert","children":"insert"}]," e mais apropriado ao nosso caso o ",["$","a",null,{"href":"https://apidock.com/rails/v6.0.0/ActiveRecord/Persistence/ClassMethods/insert_all","children":"insert_all"}],". Ótima solução!"]}],"\n",["$","p",null,{"children":["Ainda não testei esse método (ainda!), por isso vou usar como exemplo pra contextos web a gem ",["$","a",null,{"href":"https://github.com/zdennis/activerecord-import","children":"Activerecord-Import"}]," que funcionou muito bem com ",["$","em",null,{"children":"Rails 5."}]]}],"\n",["$","p",null,{"children":["Continuando com nosso exemplo, ao inserirmos 10 livros com um laço de repetição e uma ",["$","em",null,{"children":"query"}]," para cada registro, teremos um código parecido com este:"]}],"\n",["$","pre",null,{"children":["$","code",null,{"children":"10.times do |i|  \n  Book.create! name: \"book #{i}\"  \nend\n"}]}],"\n",["$","p",null,{"children":["A gem adiciona para cada Model da nossa aplicação um método chamado ",["$","em",null,{"children":"import"}],", é por ele que vamos realizar as operações, teríamos algo assim:"]}],"\n",["$","pre",null,{"children":["$","code",null,{"children":"books = []  \n10.times do |i|  \n  books << Book.new(name: \"book #{i}\")  \nend \n"}]}],"\n",["$","p",null,{"children":"Book.import books"}],"\n",["$","p",null,{"children":["Declaramos um array vazio e preenchemos com os registros criados (ainda não salvos no banco); após isso podemos passar o array como parâmetro do método ",["$","em",null,{"children":"import"}]," que nossa operação será realizada com INSERT INTO."]}],"\n",["$","p",null,{"children":["A ",["$","a",null,{"href":"https://github.com/zdennis/activerecord-import","children":"gem"}]," adiciona outras funcionalidades muito interessantes, como parametrização das validações do model, tratativas para registros com chaves duplicas etc."]}],"\n",["$","p",null,{"children":["É importante dizer também que o ganho em ",["$","strong",null,{"children":"performance"}]," e outros benefícios podem não se aplicar a todos os casos. Dependendo da quantidade de registros a ser adicionados e da capacidade do banco em lidar com os registros em poucas inserções. Por isso, uma análise deve ser construída considerando cada caso particular. Sempre vale a pena fazer um Benchmark!"]}],"\n",["$","p",null,{"children":["$","em",null,{"children":"Alguns meses atrás utilizamos a inserção em massa na refatoração de uma funcionalidade importante, pra isso fizemos alguns estudos e levantamentos de informações, o que acabou se tornando uma magia (capacitação) e agora esse texto."}]}],"\n",["$","p",null,{"children":"Se você chegou até aqui, obrigado!"}],"\n",["$","p",null,{"children":"E se isso foi de alguma forma instrutivo e te ajudou, ficarei muito feliz em saber."}]]}}]
a:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
8:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Inserção de dados em massa em bancos relacionais | Blog de Vinicius Lisboa"}],["$","meta","2",{"property":"og:title","content":"Inserção de dados em massa em bancos relacionais"}],["$","meta","3",{"property":"og:type","content":"article"}],["$","meta","4",{"property":"article:published_time","content":"2023-05-05"}],["$","meta","5",{"property":"article:author","content":"Vinicius Lisboa"}],["$","meta","6",{"name":"twitter:card","content":"summary"}],["$","meta","7",{"name":"twitter:title","content":"Inserção de dados em massa em bancos relacionais"}],["$","link","8",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]]
6:null
